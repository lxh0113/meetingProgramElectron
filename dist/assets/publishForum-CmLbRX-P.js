import{m as te}from"./myEditor-B1mTsJqf.js";/* empty css               *//* empty css               *//* empty css                *//* empty css              *//* empty css               *//* empty css                  */import{_ as ae,S as se}from"./sse-BLDKzfC7.js";/* empty css                     *//* empty css                 *//* empty css                *//* empty css            */import{_ as oe}from"./logo-C_kEI9vD.js";import{h as k,g as ne}from"./http-BrEv2jN3.js";import{d as G,r as d,x as le,v as j,o as w,c as C,b as l,e as n,w as i,h as y,t as $,f as A,Q as D,F as R,A as re,i as m,n as ie,a0 as de,a1 as ue,G as ce,B as me,j as pe,U as ve,_ as O,u as fe,S as _e}from"./index-DUL14BUD.js";import{M as ge}from"./index-BMSQkwth.js";import{u as H}from"./userStore-ZFrhfHK-.js";import{c as he,u as ye,d as we}from"./forum-DEP0Z7Sx.js";const Y="/form",Ce=(c,t)=>k({url:Y+"/chat/conversations/",method:"POST",params:{title:c,user_id:t}}),be=c=>k({url:Y+"/chat/conversations/",method:"GET",params:{user_id:c}}),Ie=(c,t)=>k({url:Y+"/chat/conversations/"+c,method:"GET",params:{user_id:t}}),De=(c,t)=>k({url:Y+"/history/conversations/"+c,method:"DELETE",params:{user_id:t}}),Te=(c,t,T)=>k({url:Y+"/history/conversations/"+c,method:"PUT",params:{title:t,user_id:T}}),Me={class:"aiBox"},ke={class:"top"},Ye={class:"outerMessage"},xe={class:"time"},Se={key:0,class:"aiMessage"},Ee={key:0,class:"message"},Ae=["innerHTML"],Pe={key:1,class:"myMessage"},Ve={class:"message"},Be={class:"inputBox"},Ue={class:"submit"},$e={class:"dialog-footer"},Fe=G({__name:"ai",setup(c){let t=new ge,T=d();const v=d(!1),M=d(""),f=d(""),_=d(!1),b=d(!1),g=H();d(""),le(b,(a,e)=>{console.log(e),a===!0?_.value=!0:_.value=!1});const r=d([]),u=async()=>{const a=await be(g.user.id+"");a.data.code===200&&(r.value=a.data.data)};d([]);const p=d([]),q=async a=>{const e=await Ie(a,g.user.id+"");console.log(e),e.data.code===200&&(p.value=e.data.data.messages,I.value={id:e.data.data.id,title:e.data.data.title,search_enabled:e.data.data.search_enabled})};j(()=>{u()});function z(a){return a.replace(/\\u[\dA-Fa-f]{4}/g,function(e){return String.fromCharCode(parseInt(e.substr(2),16))})}const I=d(),J=async(a,e)=>{const s=await Ce(a,g.user.id+"");s.data.code===201?I.value=s.data.data:m.error("连接服务器失败")},x=d(!1);let P=[],V=!1;function Q(a){P.push(a),V||F()}function F(){if(P.length===0){V=!1;return}V=!0;const a=P.shift(),e=Array.from(a);let s=0;const h=50,S=3,B=setInterval(()=>{if(s>=e.length){clearInterval(B),F();return}const U=e.slice(s,s+S).join("");setTimeout(()=>{p.value[p.value.length-1].content+=U}),s+=S},h)}const K=async()=>{I.value?.id||await J(f.value,b.value),p.value.push({id:I.value.id,role:"user",content:f.value,created_at:new Date().toDateString(),metadata:{}}),p.value.push({id:I.value.id,role:"assistant",content:"",created_at:new Date().toDateString(),metadata:{}}),x.value=!0,new se().connect(ne(I.value.id)+`?user_id=${g.user.id}`,"POST",{query:f.value,stream:!0,history:[]},e=>{let s=JSON.parse(e.data);if(console.log("收到SSE消息:",s),x.value=!1,!s?.done)if(s?.content){let h=z(s.content);console.log(h),Q(h)}else setTimeout(()=>{x.value=!1})}),f.value=""},L=d(1),W=a=>{L.value=a,v.value=!0},X=async()=>{(await Te(L.value,M.value,g.user.id+"")).data.code===200?(u(),m.success("更新成功")):m.error("更新失败"),v.value=!1},Z=async a=>{(await De(a,g.user.id+"")).data.code===200?(r.value=r.value.filter(s=>s.id!==a),m.success("删除成功")):m.error("删除失败")};return(a,e)=>{const s=ie,h=de,S=ue,B=ce,U=me,N=pe,ee=ve;return w(),C(R,null,[l("div",Me,[l("div",ke,[e[9]||(e[9]=l("span",{class:"title"}," AI工具 ",-1)),n(B,{placement:"right",width:900,trigger:"click"},{reference:i(()=>[n(s,{type:"primary"},{default:i(()=>e[5]||(e[5]=[y("查看历史会话记录")])),_:1})]),default:i(()=>[n(S,{data:r.value},{default:i(()=>[n(h,{width:"300",prop:"title",label:"标题"}),n(h,{width:"180",label:"上次更新"},{default:i(o=>[l("span",null,$(A(D)(o.row.updated_at).format("YY-M-D h:m:s")),1)]),_:1}),n(h,{width:"360",label:"操作"},{default:i(o=>[n(s,{type:"primary",onClick:E=>q(o.row.id)},{default:i(()=>e[6]||(e[6]=[y("继续上次操作")])),_:2},1032,["onClick"]),n(s,{type:"success",onClick:E=>W(o.row.id)},{default:i(()=>e[7]||(e[7]=[y("更新标题")])),_:2},1032,["onClick"]),n(s,{type:"danger",onClick:E=>Z(o.row.id)},{default:i(()=>e[8]||(e[8]=[y("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),n(U,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),class:"ml-2",style:{"--el-switch-on-color":"#13ce66"}},null,8,["modelValue"]),e[10]||(e[10]=y(" 是否开启联网搜索 "))]),l("div",{class:"content",ref:A(T)},[(w(!0),C(R,null,re(p.value,(o,E)=>(w(),C("div",Ye,[l("span",xe,$(A(D)(o.created_at).format("YY-M-D h:m:s")),1),o.role==="assistant"?(w(),C("div",Se,[e[12]||(e[12]=l("img",{class:"avatar",src:oe},null,-1)),x.value&&E===p.value.length-1?(w(),C("div",Ee,e[11]||(e[11]=[l("img",{style:{padding:"0 10px",width:"20px",height:"20px",transform:"scale(3) translateY(2px)"},src:ae,alt:""},null,-1)]))):(w(),C("div",{key:1,class:"message",innerHTML:A(t).render(o.content)},null,8,Ae))])):(w(),C("div",Pe,[l("div",Ve,$(o.content),1)]))]))),256))],512),l("div",Be,[n(N,{rows:"5",resize:"none",type:"textarea",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=o=>f.value=o),placeholder:"请输入你想输入的问题"},null,8,["modelValue"]),l("div",Ue,[n(s,{type:"primary",onClick:K},{default:i(()=>e[13]||(e[13]=[y("发送")])),_:1})])])]),n(ee,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=o=>v.value=o),title:"更新会议标题",width:"500"},{footer:i(()=>[l("div",$e,[n(s,{onClick:e[3]||(e[3]=o=>v.value=!1)},{default:i(()=>e[14]||(e[14]=[y("取消")])),_:1}),n(s,{type:"primary",onClick:X},{default:i(()=>e[15]||(e[15]=[y(" 确认 ")])),_:1})])]),default:i(()=>[e[16]||(e[16]=l("div",{style:{"margin-bottom":"10px"}},"会议标题",-1)),n(N,{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=o=>M.value=o),placeholder:"请输入会议标题"},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}}}),Le=O(Fe,[["__scopeId","data-v-a6b3b3d1"]]),Ne={class:"publishForumBox"},Re={class:"left"},Ge={class:"right"},je=G({__name:"publishForum",setup(c){const t=d({createTime:D(new Date).format("YYYY-MM-DD hh:mm:ss"),views:0,likes:0,favorites:0,label:"",content:""}),T=H(),v=fe(),M=async r=>{if(!confirm("你确定要更新并发布该帖子吗"))return;t.value.label=r.title,t.value.content=r.content,t.value.createTime=D(new Date).format("YYYY-MM-DD hh:mm:ss"),(await ye(parseInt(_.params.id),t.value)).data.code===200?(m.success("更新成功"),setTimeout(()=>{v.push("/forum/my")})):m.error("更新失败")},f=async r=>{if(_.params.id!=="undefined"){M(r);return}if(t.value.label=r.title,t.value.content=r.content,!confirm("你确定要发布该帖子吗"))return;t.value.createTime=D(new Date).format("YYYY-MM-DD hh:mm:ss"),(await he(T.user.id,t.value)).data.code===200?(m.success("发布成功"),setTimeout(()=>{v.push("/forum")})):m.error("发布失败")},_=_e(),b=async r=>{const u=await we(r,1);u.data.code===200?(t.value={createTime:D(new Date).format("YYYY-MM-DD hh:mm:ss"),views:u.data.data.views,likes:u.data.data.likes,favorites:u.data.data.favorites,label:u.data.data.label,content:u.data.data.content},console.log(t.value)):m.error("获取出错")},g=()=>{_.params?.id!==void 0&&(console.log(_.params.id),b(parseInt(_.params.id)))};return j(()=>{g()}),(r,u)=>(w(),C("div",Ne,[l("div",Re,[n(te,{content:t.value.content,title:t.value.label,onGetContent:f},null,8,["content","title"])]),l("div",Ge,[n(Le)])]))}}),it=O(je,[["__scopeId","data-v-38d78539"]]);export{it as default};
